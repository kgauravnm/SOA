from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.edge.service import Service
from selenium.webdriver.edge.options import Options
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time

# Setup Edge WebDriver
edge_driver_path = r"C:\path\to\msedgedriver.exe"  # ‚úÖ Update path
options = Options()
options.add_experimental_option("detach", True)  # Keeps browser open after script

driver = webdriver.Edge(service=Service(edge_driver_path), options=options)

# Open SSO Login Page
driver.get("https://your.portal.url")  # ‚úÖ Update with actual URL
print("üîí Please complete SSO login... waiting 30 seconds")
time.sleep(30)

# Wait for AG-Grid rows to load
try:
    wait = WebDriverWait(driver, 30)
    ag_rows = wait.until(EC.presence_of_all_elements_located(
        (By.CSS_SELECTOR, "div.ag-center-cols-container div[role='row']")))
    print(f"‚úÖ Found {len(ag_rows)} AG-Grid rows")
except Exception as e:
    print(f"‚ùå Failed to load rows: {e}")
    driver.quit()
    exit()

# Debug loop: Try clicking rows and printing content
for idx, row in enumerate(ag_rows[:5]):  # limit to 5 for testing
    print(f"\n‚ñ∂Ô∏è Processing row {idx + 1}")
    try:
        driver.execute_script("arguments[0].scrollIntoView(true);", row)
        time.sleep(1)

        # Print row structure
        html = row.get_attribute("innerHTML")
        print(f"üìÑ Row {idx + 1} inner HTML:\n{html}")

        # Try to click first cell if available
        try:
            cell = row.find_element(By.XPATH, ".//div[@role='gridcell']")
            print(f"üü¢ Clickable cell text: {cell.text.strip()}")
            cell.click()
            time.sleep(2)
        except Exception as ce:
            print(f"‚ö†Ô∏è Row {idx + 1}: No clickable gridcell. Message: {ce}")

    except Exception as e:
        print(f"‚ùå Error in row {idx + 1}: {e}")

print("\n‚úÖ Finished all rows.")